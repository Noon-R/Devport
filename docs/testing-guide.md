# Devport ãƒ†ã‚¹ãƒˆã‚¬ã‚¤ãƒ‰

## ç›®æ¬¡

1. [ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆ](#ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆ)
2. [è‡ªå‹•ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ](#è‡ªå‹•ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ)
3. [Docker ã§ã®ãƒ†ã‚¹ãƒˆ](#docker-ã§ã®ãƒ†ã‚¹ãƒˆ)
4. [ãƒªãƒ¬ãƒ¼ã‚µãƒ¼ãƒãƒ¼ã®ãƒ†ã‚¹ãƒˆ](#ãƒªãƒ¬ãƒ¼ã‚µãƒ¼ãƒãƒ¼ã®ãƒ†ã‚¹ãƒˆ)
5. [E2E ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª](#e2e-ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª)

---

## ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆ

### å‰ææ¡ä»¶

- Node.js 22+
- Go 1.25+
- Claude CLI (`npm i -g @anthropic-ai/claude-code`)
- Git

### ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/Noon-R/Devport.git
cd Devport

# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
cd web && npm install && cd ..

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ + ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰
npm run dev
```

### å€‹åˆ¥ã«èµ·å‹•ã™ã‚‹å ´åˆ

**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆGo ã‚µãƒ¼ãƒãƒ¼ï¼‰**

```powershell
# Windows PowerShell
cd server
$env:AUTH_TOKEN="password"
$env:DEV_MODE="true"
$env:RELAY_ENABLED="false"
go run .
```

```bash
# Unix/macOS
cd server
AUTH_TOKEN=password DEV_MODE=true RELAY_ENABLED=false go run .
```

ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã™ã‚‹ã¨ä»¥ä¸‹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚                                                         â”‚
â”‚   ðŸš€ Devport is running                                 â”‚
â”‚                                                         â”‚
â”‚   Local:  http://localhost:9870                         â”‚
â”‚                                                         â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆVite é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ï¼‰**

```bash
cd web
npm run dev
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:5173` ã‚’é–‹ãã¾ã™ã€‚

---

## è‡ªå‹•ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ

```bash
cd server

# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
go test ./...

# E2E ãƒ†ã‚¹ãƒˆã®ã¿
go test ./e2e/...

# è©³ç´°å‡ºåŠ›
go test -v ./...

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ã
go test -cover ./...
```

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ

```bash
cd web

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test

# ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰
npm run test -- --watch

# ã‚«ãƒãƒ¬ãƒƒã‚¸
npm run test -- --coverage
```

### ãƒªãƒ³ãƒˆãƒã‚§ãƒƒã‚¯

```bash
# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
cd web
npm run lint

# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
cd server
go vet ./...
```

---

## Docker ã§ã®ãƒ†ã‚¹ãƒˆ

### ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰

```bash
# ãƒªãƒ¬ãƒ¼ã‚µãƒ¼ãƒãƒ¼
docker build -f docker/relay/Dockerfile -t devport-relay:test .

# ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼
docker build -f docker/server/Dockerfile -t devport-server:test .
```

### docker-compose ã§ã®èµ·å‹•

```bash
# å…¨ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•
docker-compose up -d

# ãƒ­ã‚°ç¢ºèª
docker-compose logs -f

# åœæ­¢
docker-compose down
```

### å€‹åˆ¥ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ†ã‚¹ãƒˆ

```bash
# ãƒªãƒ¬ãƒ¼ã‚µãƒ¼ãƒãƒ¼
docker run -p 8080:8080 \
  -e DOMAIN=localhost \
  devport-relay:test

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:8080/health
# => {"status":"ok"}
```

---

## ãƒªãƒ¬ãƒ¼ã‚µãƒ¼ãƒãƒ¼ã®ãƒ†ã‚¹ãƒˆ

### 1. ãƒªãƒ¬ãƒ¼ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•

```bash
cd relay
go run .
```

### 2. ç™»éŒ²ãƒ†ã‚¹ãƒˆ

```bash
# æ–°è¦ç™»éŒ²
curl -X POST http://localhost:8080/api/relay/register \
  -H "Content-Type: application/json" \
  -d '{"client_version": "1.0.0"}'

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹
# {
#   "subdomain": "a1b2c3d4",
#   "relay_token": "rt_...",
#   "relay_server": "cloud.devport.app"
# }
```

### 3. ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ†ã‚¹ãƒˆ

```bash
curl -X POST http://localhost:8080/api/relay/refresh \
  -H "Content-Type: application/json" \
  -d '{"relay_token": "rt_..."}'
```

### 4. WebSocket æŽ¥ç¶šãƒ†ã‚¹ãƒˆ

```bash
# wscat ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm i -g wscat

# ãƒªãƒ¬ãƒ¼æŽ¥ç¶šï¼ˆãƒ­ãƒ¼ã‚«ãƒ« PC å´ï¼‰
wscat -c ws://a1b2c3d4.localhost:8080/relay

# ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæŽ¥ç¶šï¼ˆãƒ¢ãƒã‚¤ãƒ«å´ï¼‰
wscat -c ws://a1b2c3d4.localhost:8080/ws
```

---

## E2E ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª

### ã‚·ãƒŠãƒªã‚ª 1: åŸºæœ¬çš„ãªãƒãƒ£ãƒƒãƒˆãƒ•ãƒ­ãƒ¼

1. **èªè¨¼**
   - ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:5173` ã‚’é–‹ã
   - Server URL: `ws://localhost:9870/ws`
   - Token: `password`
   - ã€ŒConnectã€ã‚’ã‚¯ãƒªãƒƒã‚¯

2. **ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ**
   - ã€ŒNew Chatã€ã‚’ã‚¯ãƒªãƒƒã‚¯
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒä½œæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

3. **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡**
   - å…¥åŠ›æ¬„ã«ã€ŒHelloã€ã¨å…¥åŠ›
   - é€ä¿¡ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   - ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®å¿œç­”ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

4. **ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ç¢ºèª**
   - ã€Œç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ç¤ºã—ã¦ã€ã¨å…¥åŠ›
   - ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ãŒæŠ˜ã‚ŠãŸãŸã¿ã§è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

### ã‚·ãƒŠãƒªã‚ª 2: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ–ãƒ©ã‚¦ã‚¶

1. å³ä¸Šã®ðŸ“ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
3. ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å†…å®¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

### ã‚·ãƒŠãƒªã‚ª 3: Git å·®åˆ†è¡¨ç¤º

1. å³ä¸Šã® Git ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
3. ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å·®åˆ†ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

### ã‚·ãƒŠãƒªã‚ª 4: æ¨©é™ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

1. ã€Œtest.txt ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã€ã¨å…¥åŠ›
2. æ¨©é™ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
3. ã€ŒAllowã€ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

### ã‚·ãƒŠãƒªã‚ª 5: ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒ

1. ãƒãƒ£ãƒƒãƒˆã§ã„ãã¤ã‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
2. ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ãƒªãƒ­ãƒ¼ãƒ‰
3. å†æŽ¥ç¶šå¾Œã€å±¥æ­´ãŒå¾©å…ƒã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

### ã‚·ãƒŠãƒªã‚ª 6: ä¸­æ–­æ©Ÿèƒ½

1. é•·ã„å‡¦ç†ã‚’è¦æ±‚ã™ã‚‹ï¼ˆä¾‹: ã€Œ100å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã€ï¼‰
2. ç”Ÿæˆä¸­ã«ã€ŒStopã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ç”ŸæˆãŒä¸­æ–­ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒèµ·å‹•ã—ãªã„

```bash
# ãƒãƒ¼ãƒˆãŒä½¿ç”¨ä¸­ã‹ç¢ºèª
netstat -an | grep 9870

# Claude CLI ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
claude --version
```

### WebSocket æŽ¥ç¶šã‚¨ãƒ©ãƒ¼

1. CORS è¨­å®šã‚’ç¢ºèªï¼ˆé–‹ç™ºãƒ¢ãƒ¼ãƒ‰ã§ã¯ `*` ã‚’è¨±å¯ï¼‰
2. ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®šã‚’ç¢ºèª
3. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª

### ãƒªãƒ¬ãƒ¼æŽ¥ç¶šã‚¨ãƒ©ãƒ¼

```bash
# ãƒªãƒ¬ãƒ¼ã‚µãƒ¼ãƒãƒ¼ã®ãƒ­ã‚°ã‚’ç¢ºèª
docker-compose logs relay

# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æŽ¥ç¶šã‚’ç¢ºèª
curl -v http://localhost:8080/health
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

### è² è·ãƒ†ã‚¹ãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```bash
# hey ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
go install github.com/rakyll/hey@latest

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®è² è·ãƒ†ã‚¹ãƒˆ
hey -n 1000 -c 50 http://localhost:9870/health
```

### ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®ç¢ºèª

```bash
# Go ã‚µãƒ¼ãƒãƒ¼ã®ãƒ¡ãƒ¢ãƒªç¢ºèª
curl http://localhost:9870/debug/pprof/heap > heap.prof
go tool pprof heap.prof
```
