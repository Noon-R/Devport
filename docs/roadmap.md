# Devport MVP ロードマップ

## 概要

**目標**: 自分で使えるモバイル向け AI プログラミングプラットフォームの MVP を構築
**コアコンセプト**: AI 編集をメイン、手動編集をサブ

### MVP スコープ

| 項目 | 決定 |
|------|------|
| 対象ユーザー | 自分のみ（コンセプト検証用） |
| AI エージェント | Claude CLI のみ |
| 機能 | 対話型コーディング + 手動エディタ + Git diff 表示 |
| 認証 | Header トークン認証 |

---

## Phase 0: プロジェクト基盤 + 認証

**目標**: フロントエンド・バックエンドの実行可能なプロジェクト構造を構築（基本認証付き）

### フロントエンド

- [x] Vite + React + TypeScript + Tailwind の初期化
- [x] Biome の設定（ESLint + Prettier の代替）

### バックエンド

- [x] Go module の初期化
- [x] 基本 HTTP サーバー + トークン認証

### 成果物

- フロントエンド・バックエンドが実行可能、API は認証付き

---

## Phase 1: コアチャット機能

**目標**: Chat UI + Claude CLI 連携の実装

### バックエンド

- [x] Claude CLI アダプター（ストリーミング出力）
- [x] WebSocket ハンドラ

### フロントエンド

- [x] Chat コンポーネント
- [x] WebSocket 接続管理

### 成果物

- Claude CLI と対話可能、ストリーミング出力

---

## Phase 2: マルチセッション対応

**目標**: 複数の独立した対話をサポート（将来の REST API 向けセッション基盤を提供）

### バックエンド

- [x] セッション管理（作成、一覧、切り替え、削除）
- [x] セッションと Claude プロセスの紐付け
- [ ] セッションメッセージの永続化

### フロントエンド

- [x] セッション一覧サイドバー
- [x] セッションの新規作成/切り替え/削除
- [x] 現在のセッション状態表示

### 成果物

- [x] 複数の独立した対話を作成可能
- [ ] セッション切り替え時に履歴メッセージを復元

---

## Phase 3: ファイルと編集

**目標**: ファイルブラウジング、手動編集、Git 操作をサポート

### バックエンド

- [ ] ファイル REST API（`GET/PUT/DELETE /api/fs/*path`）
- [ ] Git diff API（`GET /api/git/diff`）

### フロントエンド

- [ ] ファイルブラウザ（ツリー構造）
- [ ] コードエディタ（シンタックスハイライト）
- [ ] Git diff ビューア

### 成果物

- ファイルの閲覧と編集
- ワークスペースの Git diff を表示

---

## Phase 4: 通信層の安定性

**目標**: モバイルの不安定なネットワーク環境での信頼性向上

### アーキテクチャリファクタリング: REST + WebSocket

REST + WebSocket のハイブリッドモードを採用。重要な操作は REST で信頼性を確保:

| 操作 | 方式 | 理由 |
|------|------|------|
| メッセージ送信 | POST /api/sessions/:id/messages | HTTP は信頼性が高く、リトライ可能 |
| 生成キャンセル | POST /api/sessions/:id/cancel | WebSocket 接続に依存しない |
| 権限応答 | POST /api/permissions/:id | WebSocket 接続に依存しない |
| 履歴取得 | GET /api/sessions/:id/messages | 再接続後にコンテキストを復元 |
| ストリーミング応答 | WebSocket | 双方向通信、低遅延 |

### バックエンド

- [ ] REST API: メッセージ送信、権限応答、履歴取得
- [ ] WebSocket 切断再接続サポート
- [ ] メッセージシーケンス番号、ブレークポイント継続（現在の応答のみキャッシュ）

### フロントエンド

- [ ] メッセージ送信を fetch POST に変更
- [ ] WebSocket 自動再接続
- [ ] 再接続後に REST で欠落メッセージを同期

### 成果物

- 不安定なネットワークでもメッセージが失われない
- 自動的に切断再接続と復元

---

## 技術的決定

| 決定事項 | 選択 | 理由 |
|----------|------|------|
| AI 呼び出し | `--output-format stream-json` | リアルタイムストリーミング + ツール呼び出し詳細 |
| リアルタイム通信 | WebSocket + REST（Phase 4） | WebSocket でストリーミング、REST で重要な操作の信頼性確保 |
| ファイルストレージ | ファイルシステムディレクトリ | シンプル、Claude が操作しやすい |

---

## リスクと対策

| リスク | 対策 |
|--------|------|
| Claude CLI プロセスリーク | タイムアウトで自動終了 |
| 不安定なネットワーク接続 | WebSocket 自動再接続 + REST 履歴復元（Phase 4） |
| パストラバーサル攻撃 | パス検証 |

---

## 今後の拡張方向

- マルチ AI エージェントサポート（Gemini、GPT）
- Git 操作 UI（commit、push、ブランチ管理）
- Tool AskUserQuestion サポート（Claude がユーザーに質問するインタラクティブ UI）
- system メッセージ表示の再設計（toast/banner 形式に変更、対話バブルではなく）
- 空の assistant メッセージの UI 最適化（送信失敗時の表示方法）
